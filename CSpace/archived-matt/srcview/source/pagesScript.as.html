<!-- saved from url=(0014)about:internet -->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
<title>pagesScript.as</title>
<link rel="stylesheet" type="text/css" href="../SourceStyles.css"/>
</head>

<body><pre><span class="ActionScriptASDoc">/**
 * ActionScript source file that defines the UI logic and some of the data access code.
 * This file is linked into the main application MXML file using the mx:Script tag.
 * Most of the functions in this file are called by event handlers defined in
 * the MXML.
 */</span>
<span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">mx</span>.<span class="ActionScriptDefault_Text">collections</span>.<span class="ActionScriptDefault_Text">ArrayCollection</span>;
<span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">mx</span>.<span class="ActionScriptDefault_Text">controls</span>.<span class="ActionScriptDefault_Text">Alert</span>;
<span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">mx</span>.<span class="ActionScriptDefault_Text">controls</span>.<span class="ActionScriptDefault_Text">dataGridClasses</span>.<span class="ActionScriptDefault_Text">DataGridColumn</span>;
<span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">mx</span>.<span class="ActionScriptDefault_Text">controls</span>.<span class="ActionScriptDefault_Text">dataGridClasses</span>.<span class="ActionScriptDefault_Text">DataGridItemRenderer</span>;
<span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">mx</span>.<span class="ActionScriptDefault_Text">events</span>.<span class="ActionScriptDefault_Text">CloseEvent</span>;
<span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">mx</span>.<span class="ActionScriptDefault_Text">events</span>.<span class="ActionScriptDefault_Text">DataGridEvent</span>;
<span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">mx</span>.<span class="ActionScriptDefault_Text">rpc</span>.<span class="ActionScriptDefault_Text">events</span>.<span class="ActionScriptDefault_Text">ResultEvent</span>;
<span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">mx</span>.<span class="ActionScriptDefault_Text">managers</span>.<span class="ActionScriptDefault_Text">CursorManager</span>;
<span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">mx</span>.<span class="ActionScriptDefault_Text">utils</span>.<span class="ActionScriptDefault_Text">ObjectUtil</span>;

<span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">mx</span>.<span class="ActionScriptDefault_Text">rpc</span>.<span class="ActionScriptDefault_Text">http</span>.<span class="ActionScriptDefault_Text">HTTPService</span>;
<span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">mx</span>.<span class="ActionScriptDefault_Text">rpc</span>.<span class="ActionScriptDefault_Text">events</span>.<span class="ActionScriptDefault_Text">FaultEvent</span>;
<span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">mx</span>.<span class="ActionScriptDefault_Text">rpc</span>.<span class="ActionScriptDefault_Text">AsyncToken</span>;

<span class="ActionScriptComment">//include the constant definition of the server endpoint URL
</span><span class="ActionScriptReserved">include</span> <span class="ActionScriptString">&quot;pagesconfig.as&quot;</span>;

<span class="ActionScriptASDoc">/**
 * gateway : this is the communication layer with the server side php code
 */</span>
<span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">gateway</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">HTTPService</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">HTTPService</span><span class="ActionScriptBracket/Brace">()</span>;

<span class="ActionScriptASDoc">/**
 * the array collection holds the rows that we use in the grid
 */</span>
<span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptMetadata">Bindable</span><span class="ActionScriptBracket/Brace">]</span>
<span class="ActionScriptReserved">public</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">dataArr</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">ArrayCollection</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">ArrayCollection</span><span class="ActionScriptBracket/Brace">()</span>;

<span class="ActionScriptASDoc">/**
 * column that we order by. This is updated each time the users clicks on the 
 * grid column header. 
 * see headerRelease=&quot;setOrder(event);&quot; in the DataGrid instantiation in the 
 * mxml file
 */</span>
<span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">orderColumn</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Number</span>;


<span class="ActionScriptASDoc">/**
 * the list of fields in the database table
 * needed to parse the response into hashes
 */</span> 
<span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">fields</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Object</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">{</span> <span class="ActionScriptString">&apos;pageID&apos;</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Number</span>, <span class="ActionScriptString">&apos;userID&apos;</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Number</span>, <span class="ActionScriptString">&apos;projectID&apos;</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Number</span>, <span class="ActionScriptString">&apos;url&apos;</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span>, <span class="ActionScriptString">&apos;source&apos;</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span>, <span class="ActionScriptString">&apos;query&apos;</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span>, <span class="ActionScriptString">&apos;date&apos;</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Date</span>, <span class="ActionScriptString">&apos;time&apos;</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Date</span><span class="ActionScriptBracket/Brace">}</span>;

<span class="ActionScriptASDoc">/**
 * Executes when the mxml is completed loaded. Initialize the Rest Gateway.
 */</span>
<span class="ActionScriptReserved">private</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">initApp</span><span class="ActionScriptBracket/Brace">()</span><span class="ActionScriptOperator">:</span><span class="ActionScriptReserved">void</span> 
<span class="ActionScriptBracket/Brace">{</span>

    <span class="ActionScriptASDoc">/**
     * initialize the gateway
     * - this will take care off server communication and simple xml protocol.
     */</span>
    <span class="ActionScriptDefault_Text">gateway</span>.<span class="ActionScriptDefault_Text">url</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">ENDPOINT_URL</span>;
    <span class="ActionScriptDefault_Text">gateway</span>.<span class="ActionScriptDefault_Text">method</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptString">&quot;POST&quot;</span>;
    <span class="ActionScriptDefault_Text">gateway</span>.<span class="ActionScriptDefault_Text">useProxy</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">false</span>;
    <span class="ActionScriptDefault_Text">gateway</span>.<span class="ActionScriptDefault_Text">resultFormat</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptString">&quot;e4x&quot;</span>;

    <span class="ActionScriptASDoc">/**
     * set the event handler which prevents editing of the primary key
     */</span>
    <span class="ActionScriptDefault_Text">dataGrid</span>.<span class="ActionScriptDefault_Text">addEventListener</span><span class="ActionScriptBracket/Brace">(D</span><span class="ActionScriptDefault_Text">ataGridEvent</span>.<span class="ActionScriptDefault_Text">ITEM_EDIT_BEGINNING</span>, <span class="ActionScriptDefault_Text">editCellHandler</span><span class="ActionScriptBracket/Brace">)</span>;

    <span class="ActionScriptASDoc">/**
     * set the event handler which triggers the update actions - everytime an 
     * edit operation is finished
     */</span>
    <span class="ActionScriptDefault_Text">dataGrid</span>.<span class="ActionScriptDefault_Text">addEventListener</span><span class="ActionScriptBracket/Brace">(D</span><span class="ActionScriptDefault_Text">ataGridEvent</span>.<span class="ActionScriptDefault_Text">ITEM_EDIT_END</span>, <span class="ActionScriptDefault_Text">editCellEnd</span><span class="ActionScriptBracket/Brace">)</span>;

    <span class="ActionScriptDefault_Text">gateway</span>.<span class="ActionScriptDefault_Text">addEventListener</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">ResultEvent</span>.<span class="ActionScriptDefault_Text">RESULT</span>, <span class="ActionScriptDefault_Text">resultHandler</span><span class="ActionScriptBracket/Brace">)</span>;
    <span class="ActionScriptDefault_Text">gateway</span>.<span class="ActionScriptDefault_Text">addEventListener</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">FaultEvent</span>.<span class="ActionScriptDefault_Text">FAULT</span>, <span class="ActionScriptDefault_Text">faultHandler</span><span class="ActionScriptBracket/Brace">)</span>;
    
    <span class="ActionScriptDefault_Text">fill</span><span class="ActionScriptBracket/Brace">()</span>;
<span class="ActionScriptBracket/Brace">}</span>

<span class="ActionScriptASDoc">/**
 * Disallow editing of the primary key column.
 * @param e DataGridEvent contains details about the row and column of the grid 
 * where the user clicked
 */</span>
<span class="ActionScriptReserved">private</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">editCellHandler</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">e</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">DataGridEvent</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">:</span><span class="ActionScriptReserved">void</span>
<span class="ActionScriptBracket/Brace">{</span>
    <span class="ActionScriptASDoc">/**
     * if the user clicked on the primary key column, stop editing
     */</span>
    <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">e</span>.<span class="ActionScriptDefault_Text">dataField</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptString">&quot;pageIDCol&quot;</span><span class="ActionScriptBracket/Brace">)</span>
    <span class="ActionScriptBracket/Brace">{</span>
        <span class="ActionScriptDefault_Text">e</span>.<span class="ActionScriptDefault_Text">preventDefault</span><span class="ActionScriptBracket/Brace">()</span>;
        <span class="ActionScriptReserved">return</span>;
    <span class="ActionScriptBracket/Brace">}</span>
<span class="ActionScriptBracket/Brace">}</span>

<span class="ActionScriptASDoc">/**
 * Click handler for &quot;Filter&quot; button.
 * When setting another filter, refresh the collection, and load the new data
 */</span>
<span class="ActionScriptReserved">private</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">filterResults</span><span class="ActionScriptBracket/Brace">()</span><span class="ActionScriptOperator">:</span><span class="ActionScriptReserved">void</span>
<span class="ActionScriptBracket/Brace">{</span>
    <span class="ActionScriptDefault_Text">fill</span><span class="ActionScriptBracket/Brace">()</span>;
<span class="ActionScriptBracket/Brace">}</span>

<span class="ActionScriptASDoc">/**
 * Event handler triggered when the user finishes editing an entry
 * triggers an &quot;update&quot; server command
 */</span>
<span class="ActionScriptReserved">private</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">editCellEnd</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">e</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">DataGridEvent</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">:</span><span class="ActionScriptReserved">void</span>
<span class="ActionScriptBracket/Brace">{</span>
    <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">dsRowIndex</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">e</span>.<span class="ActionScriptDefault_Text">rowIndex</span>;
    <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">dsFieldName</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">e</span>.<span class="ActionScriptDefault_Text">dataField</span>;
    <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">dsColumnIndex</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">e</span>.<span class="ActionScriptDefault_Text">columnIndex</span>;

    <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">vo</span><span class="ActionScriptOperator">:*</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">dataArr</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">dsRowIndex</span><span class="ActionScriptBracket/Brace">]</span>;
    
    <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">col</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">DataGridColumn</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">dataGrid</span>.<span class="ActionScriptDefault_Text">columns</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">dsColumnIndex</span><span class="ActionScriptBracket/Brace">]</span>;
    <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">newvalue</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">dataGrid</span>.<span class="ActionScriptDefault_Text">itemEditorInstance</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">col</span>.<span class="ActionScriptDefault_Text">editorDataField</span><span class="ActionScriptBracket/Brace">]</span>;

    <span class="ActionScripttrace">trace</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&quot;a:&quot;</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">dsRowIndex</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptString">&quot;, &quot;</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">dsFieldName</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptString">&quot;, &quot;</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">dsColumnIndex</span><span class="ActionScriptBracket/Brace">)</span>;

    <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">parameters</span><span class="ActionScriptOperator">:*</span> <span class="ActionScriptOperator">=</span>
    <span class="ActionScriptBracket/Brace">{</span>
        <span class="ActionScriptString">&quot;pageID&quot;</span><span class="ActionScriptOperator">:</span> <span class="ActionScriptDefault_Text">vo</span>.<span class="ActionScriptDefault_Text">pageIDCol</span>,        <span class="ActionScriptString">&quot;userID&quot;</span><span class="ActionScriptOperator">:</span> <span class="ActionScriptDefault_Text">vo</span>.<span class="ActionScriptDefault_Text">userIDCol</span>,        <span class="ActionScriptString">&quot;projectID&quot;</span><span class="ActionScriptOperator">:</span> <span class="ActionScriptDefault_Text">vo</span>.<span class="ActionScriptDefault_Text">projectIDCol</span>,        <span class="ActionScriptString">&quot;url&quot;</span><span class="ActionScriptOperator">:</span> <span class="ActionScriptDefault_Text">vo</span>.<span class="ActionScriptDefault_Text">urlCol</span>,        <span class="ActionScriptString">&quot;source&quot;</span><span class="ActionScriptOperator">:</span> <span class="ActionScriptDefault_Text">vo</span>.<span class="ActionScriptDefault_Text">sourceCol</span>,        <span class="ActionScriptString">&quot;query&quot;</span><span class="ActionScriptOperator">:</span> <span class="ActionScriptDefault_Text">vo</span>.<span class="ActionScriptDefault_Text">queryCol</span>,        <span class="ActionScriptString">&quot;date&quot;</span><span class="ActionScriptOperator">:</span> <span class="ActionScriptDefault_Text">vo</span>.<span class="ActionScriptDefault_Text">dateCol</span>,        <span class="ActionScriptString">&quot;time&quot;</span><span class="ActionScriptOperator">:</span> <span class="ActionScriptDefault_Text">vo</span>.<span class="ActionScriptDefault_Text">timeCol</span>    <span class="ActionScriptBracket/Brace">}</span>

    <span class="ActionScriptDefault_Text">parameters</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">dsFieldName</span>.<span class="ActionScriptDefault_Text">substr</span><span class="ActionScriptBracket/Brace">(</span>0,<span class="ActionScriptDefault_Text">dsFieldName</span>.<span class="ActionScriptDefault_Text">length</span><span class="ActionScriptOperator">-</span>3<span class="ActionScriptBracket/Brace">)]</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">newvalue</span>;

    <span class="ActionScriptASDoc">/**
     * execute the server &quot;update&quot; command
     */</span>
    <span class="ActionScriptDefault_Text">doRequest</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&quot;Update&quot;</span>, <span class="ActionScriptDefault_Text">parameters</span>, <span class="ActionScriptDefault_Text">saveItemHandler</span><span class="ActionScriptBracket/Brace">)</span>;    

<span class="ActionScriptBracket/Brace">}</span>

<span class="ActionScriptASDoc">/**
 * result handler for the &quot;update&quot; server command.
 * Just alert the error, or do nothing if it&apos;s ok - the data has already 
 * been updated in the grid
 */</span>
<span class="ActionScriptReserved">private</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">saveItemHandler</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">e</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Object</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">:</span><span class="ActionScriptReserved">void</span>
<span class="ActionScriptBracket/Brace">{</span>
    <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">e</span>.<span class="ActionScriptDefault_Text">isError</span><span class="ActionScriptBracket/Brace">)</span>
    <span class="ActionScriptBracket/Brace">{</span>
        <span class="ActionScriptDefault_Text">Alert</span>.<span class="ActionScriptDefault_Text">show</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&quot;Error: &quot;</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">e</span>.<span class="ActionScriptDefault_Text">data</span>.<span class="ActionScriptDefault_Text">error</span><span class="ActionScriptBracket/Brace">)</span>;
    <span class="ActionScriptBracket/Brace">}</span>
    <span class="ActionScriptReserved">else</span>
    <span class="ActionScriptBracket/Brace">{</span>
    <span class="ActionScriptBracket/Brace">}</span>     
<span class="ActionScriptBracket/Brace">}</span>

<span class="ActionScriptASDoc">/**
 * dragHeader handler for the datagrid. This handler is executed when the user 
 * clicks on a header column in the datagrid
 * updates the global orderColumn variable, refreshes the TableCollection
 * @param event DataGridEvent details about the column
 */</span>
<span class="ActionScriptReserved">private</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">setOrder</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">event</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">DataGridEvent</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">:</span><span class="ActionScriptReserved">void</span> 
<span class="ActionScriptBracket/Brace">{</span>
    <span class="ActionScriptDefault_Text">orderColumn</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">event</span>.<span class="ActionScriptDefault_Text">columnIndex</span>;
    <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">col</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">DataGridColumn</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">dataGrid</span>.<span class="ActionScriptDefault_Text">columns</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">orderColumn</span><span class="ActionScriptBracket/Brace">]</span>;
    <span class="ActionScriptDefault_Text">col</span>.<span class="ActionScriptDefault_Text">sortDescending</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptOperator">!</span><span class="ActionScriptDefault_Text">col</span>.<span class="ActionScriptDefault_Text">sortDescending</span>;
    
    <span class="ActionScriptDefault_Text">event</span>.<span class="ActionScriptDefault_Text">preventDefault</span><span class="ActionScriptBracket/Brace">()</span>;
    <span class="ActionScriptDefault_Text">fill</span><span class="ActionScriptBracket/Brace">()</span>;
<span class="ActionScriptBracket/Brace">}</span>

<span class="ActionScriptASDoc">/**
 * Click handler for the &quot;Save&quot; button in the &quot;Add&quot; state
 * collects the information in the form and adds a new object to the collection
 */</span>
<span class="ActionScriptReserved">private</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">insertItem</span><span class="ActionScriptBracket/Brace">()</span><span class="ActionScriptOperator">:</span><span class="ActionScriptReserved">void</span> <span class="ActionScriptBracket/Brace">{</span>
    <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">parameters</span><span class="ActionScriptOperator">:*</span> <span class="ActionScriptOperator">=</span>
    <span class="ActionScriptBracket/Brace">{</span>
        <span class="ActionScriptString">&quot;method&quot;</span><span class="ActionScriptOperator">:</span> <span class="ActionScriptString">&quot;Insert&quot;</span>,        <span class="ActionScriptString">&quot;userID&quot;</span><span class="ActionScriptOperator">:</span> <span class="ActionScriptDefault_Text">userIDCol</span>.<span class="ActionScriptDefault_Text">text</span>,        <span class="ActionScriptString">&quot;projectID&quot;</span><span class="ActionScriptOperator">:</span> <span class="ActionScriptDefault_Text">projectIDCol</span>.<span class="ActionScriptDefault_Text">text</span>,        <span class="ActionScriptString">&quot;url&quot;</span><span class="ActionScriptOperator">:</span> <span class="ActionScriptDefault_Text">urlCol</span>.<span class="ActionScriptDefault_Text">text</span>,        <span class="ActionScriptString">&quot;source&quot;</span><span class="ActionScriptOperator">:</span> <span class="ActionScriptDefault_Text">sourceCol</span>.<span class="ActionScriptDefault_Text">text</span>,        <span class="ActionScriptString">&quot;query&quot;</span><span class="ActionScriptOperator">:</span> <span class="ActionScriptDefault_Text">queryCol</span>.<span class="ActionScriptDefault_Text">text</span>,        <span class="ActionScriptString">&quot;date&quot;</span><span class="ActionScriptOperator">:</span> <span class="ActionScriptDefault_Text">dateCol</span>.<span class="ActionScriptDefault_Text">text</span>,        <span class="ActionScriptString">&quot;time&quot;</span><span class="ActionScriptOperator">:</span> <span class="ActionScriptDefault_Text">timeCol</span>.<span class="ActionScriptDefault_Text">text</span>    <span class="ActionScriptBracket/Brace">}</span>;

    <span class="ActionScriptASDoc">/**
     * execute the server &quot;insert&quot; command
     */</span>
    <span class="ActionScriptDefault_Text">doRequest</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&quot;Insert&quot;</span>, <span class="ActionScriptDefault_Text">parameters</span>, <span class="ActionScriptDefault_Text">insertItemHandler</span><span class="ActionScriptBracket/Brace">)</span>;
<span class="ActionScriptBracket/Brace">}</span>

<span class="ActionScriptASDoc">/**
 * Result handler for the insert call.
 * Alert the error if it exists
 * if the call went through ok, return to the list, and refresh the data
 */</span>
<span class="ActionScriptReserved">private</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">insertItemHandler</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">e</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Object</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">:</span><span class="ActionScriptReserved">void</span>
<span class="ActionScriptBracket/Brace">{</span>
    <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">e</span>.<span class="ActionScriptDefault_Text">isError</span><span class="ActionScriptBracket/Brace">)</span>
    <span class="ActionScriptBracket/Brace">{</span>
        <span class="ActionScriptDefault_Text">Alert</span>.<span class="ActionScriptDefault_Text">show</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&quot;Error: &quot;</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">e</span>.<span class="ActionScriptDefault_Text">data</span>.<span class="ActionScriptDefault_Text">error</span><span class="ActionScriptBracket/Brace">)</span>;
    <span class="ActionScriptBracket/Brace">}</span>
    <span class="ActionScriptReserved">else</span>
    <span class="ActionScriptBracket/Brace">{</span>
        <span class="ActionScriptDefault_Text">goToView</span><span class="ActionScriptBracket/Brace">()</span>;
        <span class="ActionScriptDefault_Text">fill</span><span class="ActionScriptBracket/Brace">()</span>;
    <span class="ActionScriptBracket/Brace">}</span>     
<span class="ActionScriptBracket/Brace">}</span>

<span class="ActionScriptASDoc">/** 
 * general utility function for refreshing the data 
 * gets the filtering and ordering, then dispatches a new server call
 *
 */</span>
<span class="ActionScriptReserved">private</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">fill</span><span class="ActionScriptBracket/Brace">()</span><span class="ActionScriptOperator">:</span><span class="ActionScriptReserved">void</span> 
<span class="ActionScriptBracket/Brace">{</span>
    <span class="ActionScriptASDoc">/**
     * find the order parameters
     */</span>
    <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">desc</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Boolean</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">false</span>;
    <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">orderField</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptString">&apos;&apos;</span>;
    
    <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(!</span><span class="ActionScriptDefault_Text">isNaN</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">orderColumn</span><span class="ActionScriptBracket/Brace">))</span>
    <span class="ActionScriptBracket/Brace">{</span>
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">col</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">DataGridColumn</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">dataGrid</span>.<span class="ActionScriptDefault_Text">columns</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">orderColumn</span><span class="ActionScriptBracket/Brace">]</span>;
        <span class="ActionScriptDefault_Text">desc</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">col</span>.<span class="ActionScriptDefault_Text">sortDescending</span>;
        <span class="ActionScriptComment">//remove the &apos;Col&apos; particle
</span>        <span class="ActionScriptDefault_Text">orderField</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">col</span>.<span class="ActionScriptDefault_Text">dataField</span>.<span class="ActionScriptDefault_Text">substr</span><span class="ActionScriptBracket/Brace">(</span>0,<span class="ActionScriptDefault_Text">col</span>.<span class="ActionScriptDefault_Text">dataField</span>.<span class="ActionScriptDefault_Text">length</span><span class="ActionScriptOperator">-</span>3<span class="ActionScriptBracket/Brace">)</span>;
    <span class="ActionScriptBracket/Brace">}</span>

    <span class="ActionScriptDefault_Text">dataGrid</span>.<span class="ActionScriptDefault_Text">enabled</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">false</span>;
    <span class="ActionScriptDefault_Text">CursorManager</span>.<span class="ActionScriptDefault_Text">setBusyCursor</span><span class="ActionScriptBracket/Brace">()</span>;

    <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">parameters</span><span class="ActionScriptOperator">:*</span> <span class="ActionScriptOperator">=</span>
    <span class="ActionScriptBracket/Brace">{</span>
        <span class="ActionScriptString">&quot;orderField&quot;</span><span class="ActionScriptOperator">:</span> <span class="ActionScriptDefault_Text">orderField</span>,
        <span class="ActionScriptString">&quot;orderDirection&quot;</span><span class="ActionScriptOperator">:</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">desc</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">?</span> <span class="ActionScriptString">&quot;DESC&quot;</span> <span class="ActionScriptOperator">:</span> <span class="ActionScriptString">&quot;ASC&quot;</span>, 
        <span class="ActionScriptString">&quot;filter&quot;</span><span class="ActionScriptOperator">:</span> <span class="ActionScriptDefault_Text">filterTxt</span>.<span class="ActionScriptDefault_Text">text</span>
    <span class="ActionScriptBracket/Brace">}</span>
    <span class="ActionScriptASDoc">/**
     * execute the server &quot;select&quot; command
     */</span>
    <span class="ActionScriptDefault_Text">doRequest</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&quot;FindAll&quot;</span>, <span class="ActionScriptDefault_Text">parameters</span>, <span class="ActionScriptDefault_Text">fillHandler</span><span class="ActionScriptBracket/Brace">)</span>;
<span class="ActionScriptBracket/Brace">}</span>

<span class="ActionScriptASDoc">/** 
 * result handler for the fill call. 
 * if it is an error, show it to the user, else refill the arraycollection with the new data
 *
 */</span>
<span class="ActionScriptReserved">private</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">fillHandler</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">e</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Object</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">:</span><span class="ActionScriptReserved">void</span>
<span class="ActionScriptBracket/Brace">{</span>
    <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">e</span>.<span class="ActionScriptDefault_Text">isError</span><span class="ActionScriptBracket/Brace">)</span>
    <span class="ActionScriptBracket/Brace">{</span>
        <span class="ActionScriptDefault_Text">Alert</span>.<span class="ActionScriptDefault_Text">show</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&quot;Error: &quot;</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">e</span>.<span class="ActionScriptDefault_Text">data</span>.<span class="ActionScriptDefault_Text">error</span><span class="ActionScriptBracket/Brace">)</span>;
    <span class="ActionScriptBracket/Brace">}</span> 
    <span class="ActionScriptReserved">else</span>
    <span class="ActionScriptBracket/Brace">{</span>
        <span class="ActionScriptDefault_Text">dataArr</span>.<span class="ActionScriptDefault_Text">removeAll</span><span class="ActionScriptBracket/Brace">()</span>;
        <span class="ActionScriptReserved">for</span> <span class="ActionScriptReserved">each</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">row</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">XML</span> <span class="ActionScriptReserved">in</span> <span class="ActionScriptDefault_Text">e</span>.<span class="ActionScriptDefault_Text">data</span>.<span class="ActionScriptDefault_Text">row</span><span class="ActionScriptBracket/Brace">)</span> 
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">temp</span><span class="ActionScriptOperator">:*</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">{}</span>;
            <span class="ActionScriptReserved">for</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">key</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span> <span class="ActionScriptReserved">in</span> <span class="ActionScriptDefault_Text">fields</span><span class="ActionScriptBracket/Brace">)</span> 
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">temp</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">key</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptString">&apos;Col&apos;</span><span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">row</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">key</span><span class="ActionScriptBracket/Brace">]</span>;
            <span class="ActionScriptBracket/Brace">}</span>

            <span class="ActionScriptDefault_Text">dataArr</span>.<span class="ActionScriptDefault_Text">addItem</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">temp</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptBracket/Brace">}</span>

        <span class="ActionScriptDefault_Text">CursorManager</span>.<span class="ActionScriptDefault_Text">removeBusyCursor</span><span class="ActionScriptBracket/Brace">()</span>;
        <span class="ActionScriptDefault_Text">dataGrid</span>.<span class="ActionScriptDefault_Text">enabled</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">true</span>;
    <span class="ActionScriptBracket/Brace">}</span>    
<span class="ActionScriptBracket/Brace">}</span>

<span class="ActionScriptASDoc">/**
 * Click handler for the &quot;delete&quot; button in the list
 * confirms the action and launches the deleteClickHandler function
 */</span>
<span class="ActionScriptReserved">private</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">deleteItem</span><span class="ActionScriptBracket/Brace">()</span><span class="ActionScriptOperator">:</span><span class="ActionScriptReserved">void</span> <span class="ActionScriptBracket/Brace">{</span>
    
    <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">dataGrid</span>.<span class="ActionScriptDefault_Text">selectedItem</span><span class="ActionScriptBracket/Brace">)</span>
    <span class="ActionScriptBracket/Brace">{</span>
        <span class="ActionScriptDefault_Text">Alert</span>.<span class="ActionScriptDefault_Text">show</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&quot;Are you sure you want to delete the selected record?&quot;</span>,
        <span class="ActionScriptString">&quot;Confirm Delete&quot;</span>, 3, <span class="ActionScriptReserved">this</span>, <span class="ActionScriptDefault_Text">deleteClickHandler</span><span class="ActionScriptBracket/Brace">)</span>;
    <span class="ActionScriptBracket/Brace">}</span>
    
<span class="ActionScriptBracket/Brace">}</span>

<span class="ActionScriptASDoc">/**
 * Event handler function for the Confirm dialog raises when the 
 * Delete button is pressed.
 * If the pressed button was Yes, then the product is deleted.
 * @param object event
 * @return nothing
 */</span> 
<span class="ActionScriptReserved">private</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">deleteClickHandler</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">event</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">CloseEvent</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">:</span><span class="ActionScriptReserved">void</span>
<span class="ActionScriptBracket/Brace">{</span>
    <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">event</span>.<span class="ActionScriptDefault_Text">detail</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptDefault_Text">Alert</span>.<span class="ActionScriptDefault_Text">YES</span><span class="ActionScriptBracket/Brace">)</span> 
    <span class="ActionScriptBracket/Brace">{</span>
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">vo</span><span class="ActionScriptOperator">:*</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">dataGrid</span>.<span class="ActionScriptDefault_Text">selectedItem</span>;

        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">parameters</span><span class="ActionScriptOperator">:*</span> <span class="ActionScriptOperator">=</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptString">&quot;pageID&quot;</span><span class="ActionScriptOperator">:</span> <span class="ActionScriptDefault_Text">vo</span>.<span class="ActionScriptDefault_Text">pageIDCol</span>
        <span class="ActionScriptBracket/Brace">}</span>

        <span class="ActionScriptASDoc">/**
         * execute the server &quot;delete&quot; command
         */</span>
        <span class="ActionScriptDefault_Text">doRequest</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&quot;Delete&quot;</span>, <span class="ActionScriptDefault_Text">parameters</span>, <span class="ActionScriptDefault_Text">deleteHandler</span><span class="ActionScriptBracket/Brace">)</span>;

        <span class="ActionScriptDefault_Text">setTimeout</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptfunction">function</span><span class="ActionScriptBracket/Brace">()</span><span class="ActionScriptOperator">:</span><span class="ActionScriptReserved">void</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptDefault_Text">dataGrid</span>.<span class="ActionScriptDefault_Text">destroyItemEditor</span><span class="ActionScriptBracket/Brace">()</span>;
        <span class="ActionScriptBracket/Brace">}</span>,
        1<span class="ActionScriptBracket/Brace">)</span>;
    <span class="ActionScriptBracket/Brace">}</span>
<span class="ActionScriptBracket/Brace">}</span>

<span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">deleteHandler</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">e</span><span class="ActionScriptOperator">:*</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">:</span><span class="ActionScriptReserved">void</span>
<span class="ActionScriptBracket/Brace">{</span>
    <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">e</span>.<span class="ActionScriptDefault_Text">isError</span><span class="ActionScriptBracket/Brace">)</span>
    <span class="ActionScriptBracket/Brace">{</span>
        <span class="ActionScriptDefault_Text">Alert</span>.<span class="ActionScriptDefault_Text">show</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&quot;Error: &quot;</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">e</span>.<span class="ActionScriptDefault_Text">data</span>.<span class="ActionScriptDefault_Text">error</span><span class="ActionScriptBracket/Brace">)</span>;
    <span class="ActionScriptBracket/Brace">}</span>
    <span class="ActionScriptReserved">else</span>
    <span class="ActionScriptBracket/Brace">{</span>
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">pageID</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">parseInt</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">e</span>.<span class="ActionScriptDefault_Text">data</span>.<span class="ActionScriptDefault_Text">toString</span><span class="ActionScriptBracket/Brace">()</span>, 10<span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptReserved">for</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">index</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> 0; <span class="ActionScriptDefault_Text">index</span> <span class="ActionScriptOperator">&lt;</span> <span class="ActionScriptDefault_Text">dataArr</span>.<span class="ActionScriptDefault_Text">length</span>; <span class="ActionScriptDefault_Text">index</span><span class="ActionScriptOperator">++</span><span class="ActionScriptBracket/Brace">)</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">dataArr</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">index</span><span class="ActionScriptBracket/Brace">]</span>.<span class="ActionScriptDefault_Text">pageIDCol</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptDefault_Text">pageID</span><span class="ActionScriptBracket/Brace">)</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">dataArr</span>.<span class="ActionScriptDefault_Text">removeItemAt</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">index</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptReserved">break</span>;
            <span class="ActionScriptBracket/Brace">}</span>
        <span class="ActionScriptBracket/Brace">}</span>
    <span class="ActionScriptBracket/Brace">}</span>     
<span class="ActionScriptBracket/Brace">}</span>

<span class="ActionScriptASDoc">/**
 * deserializes the xml response
 * handles error cases
 *
 * @param e ResultEvent the server response and details about the connection
 */</span>
<span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">deserialize</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">obj</span><span class="ActionScriptOperator">:*</span>, <span class="ActionScriptDefault_Text">e</span><span class="ActionScriptOperator">:*</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">:*</span>
<span class="ActionScriptBracket/Brace">{</span>
    <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">toret</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Object</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">{}</span>;
    
    <span class="ActionScriptDefault_Text">toret</span>.<span class="ActionScriptDefault_Text">originalEvent</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">e</span>;

    <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">obj</span>.<span class="ActionScriptDefault_Text">data</span>.<span class="ActionScriptDefault_Text">elements</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&quot;error&quot;</span><span class="ActionScriptBracket/Brace">)</span>.<span class="ActionScriptDefault_Text">length</span><span class="ActionScriptBracket/Brace">()</span> <span class="ActionScriptOperator">&gt;</span> 0<span class="ActionScriptBracket/Brace">)</span>
    <span class="ActionScriptBracket/Brace">{</span>
        <span class="ActionScriptDefault_Text">toret</span>.<span class="ActionScriptDefault_Text">isError</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">true</span>;
        <span class="ActionScriptDefault_Text">toret</span>.<span class="ActionScriptDefault_Text">data</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">obj</span>.<span class="ActionScriptDefault_Text">data</span>;
    <span class="ActionScriptBracket/Brace">}</span>
    <span class="ActionScriptReserved">else</span>
    <span class="ActionScriptBracket/Brace">{</span>
        <span class="ActionScriptDefault_Text">toret</span>.<span class="ActionScriptDefault_Text">isError</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">false</span>;
        <span class="ActionScriptDefault_Text">toret</span>.<span class="ActionScriptDefault_Text">metadata</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">obj</span>.<span class="ActionScriptDefault_Text">metadata</span>;
        <span class="ActionScriptDefault_Text">toret</span>.<span class="ActionScriptDefault_Text">data</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">obj</span>.<span class="ActionScriptDefault_Text">data</span>;
    <span class="ActionScriptBracket/Brace">}</span>

    <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">toret</span>;
<span class="ActionScriptBracket/Brace">}</span>

<span class="ActionScriptASDoc">/**
 * result handler for the gateway
 * deserializes the result, and then calls the REAL event handler
 * (set when making a request in the doRequest function)
 *
 * @param e ResultEvent the server response and details about the connection
 */</span>
<span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">resultHandler</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">e</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">ResultEvent</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">:</span><span class="ActionScriptReserved">void</span>
<span class="ActionScriptBracket/Brace">{</span>
    <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">topass</span><span class="ActionScriptOperator">:*</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">deserialize</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">e</span>.<span class="ActionScriptDefault_Text">result</span>, <span class="ActionScriptDefault_Text">e</span><span class="ActionScriptBracket/Brace">)</span>;
    <span class="ActionScriptDefault_Text">e</span>.<span class="ActionScriptDefault_Text">token</span>.<span class="ActionScriptDefault_Text">handler</span>.<span class="ActionScriptDefault_Text">call</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptReserved">null</span>, <span class="ActionScriptDefault_Text">topass</span><span class="ActionScriptBracket/Brace">)</span>;
<span class="ActionScriptBracket/Brace">}</span>

<span class="ActionScriptASDoc">/**
 * fault handler for this connection
 *
 * @param e FaultEvent the error object
 */</span>
<span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">faultHandler</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">e</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">FaultEvent</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">:</span><span class="ActionScriptReserved">void</span>
<span class="ActionScriptBracket/Brace">{</span>
    <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">errorMessage</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptString">&quot;Connection error: &quot;</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">e</span>.<span class="ActionScriptDefault_Text">fault</span>.<span class="ActionScriptDefault_Text">faultString</span>; 
    <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">e</span>.<span class="ActionScriptDefault_Text">fault</span>.<span class="ActionScriptDefault_Text">faultDetail</span><span class="ActionScriptBracket/Brace">)</span> 
    <span class="ActionScriptBracket/Brace">{</span> 
        <span class="ActionScriptDefault_Text">errorMessage</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptString">&quot;\n\nAdditional detail: &quot;</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">e</span>.<span class="ActionScriptDefault_Text">fault</span>.<span class="ActionScriptDefault_Text">faultDetail</span>; 
    <span class="ActionScriptBracket/Brace">}</span> 
    <span class="ActionScriptDefault_Text">Alert</span>.<span class="ActionScriptDefault_Text">show</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">errorMessage</span><span class="ActionScriptBracket/Brace">)</span>;
<span class="ActionScriptBracket/Brace">}</span>

<span class="ActionScriptASDoc">/**
 * makes a request to the server using the gateway instance
 *
 * @param method_name String the method name used in the server dispathcer
 * @param parameters Object name value pairs for sending in post
 * @param callback Function function to be called when the call completes
 */</span>
<span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">doRequest</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">method_name</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span>, <span class="ActionScriptDefault_Text">parameters</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Object</span>, <span class="ActionScriptDefault_Text">callback</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Function</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">:</span><span class="ActionScriptReserved">void</span>
<span class="ActionScriptBracket/Brace">{</span>
    <span class="ActionScriptComment">// add the method to the parameters list
</span>    <span class="ActionScriptDefault_Text">parameters</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptString">&apos;method&apos;</span><span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">method_name</span>;

    <span class="ActionScriptDefault_Text">gateway</span>.<span class="ActionScriptDefault_Text">request</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">parameters</span>;

    <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">call</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">AsyncToken</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">gateway</span>.<span class="ActionScriptDefault_Text">send</span><span class="ActionScriptBracket/Brace">()</span>;
    <span class="ActionScriptDefault_Text">call</span>.<span class="ActionScriptDefault_Text">request_params</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">gateway</span>.<span class="ActionScriptDefault_Text">request</span>;

    <span class="ActionScriptDefault_Text">call</span>.<span class="ActionScriptDefault_Text">handler</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">callback</span>;
<span class="ActionScriptBracket/Brace">}</span>


<span class="ActionScriptASDoc">/**
 * Click handler when the user click the &quot;Create&quot; button
 * Load the &quot;Update&quot; canvas.
 */</span>
<span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">goToUpdate</span><span class="ActionScriptBracket/Brace">()</span><span class="ActionScriptOperator">:</span><span class="ActionScriptReserved">void</span>
<span class="ActionScriptBracket/Brace">{</span>
    <span class="ActionScriptDefault_Text">applicationScreens</span>.<span class="ActionScriptDefault_Text">selectedChild</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">update</span>;
<span class="ActionScriptBracket/Brace">}</span>

<span class="ActionScriptASDoc">/**
 * Load the &quot;View&quot; canvas.
 */</span>
<span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">goToView</span><span class="ActionScriptBracket/Brace">()</span><span class="ActionScriptOperator">:</span><span class="ActionScriptReserved">void</span>
<span class="ActionScriptBracket/Brace">{</span>
    <span class="ActionScriptDefault_Text">applicationScreens</span>.<span class="ActionScriptDefault_Text">selectedChild</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">view</span>;
<span class="ActionScriptBracket/Brace">}</span>
</pre></body>
</html>
